<?xml version="1.0" encoding="utf-8"?>
<!-- EN-Revision: 1.7 Maintainer: tony2001 Status: ready -->
<!-- $Revision: 1.2 $ -->
   <sect1 xml:id="install.unix.apache2" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>Apache 2.0 на Unix системах</title>
    <para>
     Этот раздел описывает установку PHP c Apache 2.0 на Unix системах.
    </para>
   
    &warn.apache2.compat;
    
    <para>
     За базовой информацией об Apache 2.0 обращаетесь к 
     <link xlink:href="&url.apache2.docs;">документации Apache</link>.
   </para>

    &install.snippet.apache2.compat;

    <para>
     Скачайте последнюю версию <link xlink:href= "&url.apache;">
     Apache 2.0</link> и соответствующую версию PHP.
     Это краткое руководство описывает лишь базовую установку Apache 2.0 и PHP
     Для получения более детальной информации прочитайте <link
      xlink:href="&url.apache2.docs;">документацию Apache</link>.
     В инструкции ниже опущены номера версий - замените 'NN' на
     номер версии присутствующий в именах скачанных вами файлов.
    </para>
    <example>
     <title>
      Инструкция по установке PHP, как подгружаемого модуля Apache 2
     </title>
     <screen>
<![CDATA[
1.  gzip -d httpd-2_0_NN.tar.gz
2.  tar xvf httpd-2_0_NN.tar
3.  gunzip php-NN.tar.gz
4.  tar -xvf php-NN.tar
5.  cd httpd-2_0_NN
6.  ./configure --enable-so
7.  make
8.  make install

    Теперь ваш Apache 2.0.NN доступен как /usr/local/apache2,
    сконфигурирован с поддержкой подгружаемых модулей и стандартным
    мульти-процессорным модулем (MPM) prefork.
    Чтобы простестировать правильность установки используйте стандартную
    процедуру запуска Apache, такую как:
    /usr/local/apache2/bin/apachectl start
    Затем остановите сервер, чтобы сконфигурировать и установить PHP
    /usr/local/apache2/bin/apachectl stop.

9.  cd ../php-NN

10. Теперь мы сконфигурируем PHP. Здесь вы можете настроить установку
     PHP при помощи параметров командной строки скрипта configure.
     Вы можете включить или выключить некоторые расширения. Просмотрите вывод
     команды ./configure --help для получения полного списка параметров
     конфигурации. В нашем примере мы сконфигурируем PHP очень просто -
     с поддержкой Apache и MySQL. В вашей системе путь до apxs может
     отличаться от указанного в примере, так же бинарный файл может иметь имя
     apxs2. 
    
      ./configure --with-apxs2=/usr/local/apache2/bin/apxs --with-mysql

11. make
12. make install

    Если вы решите изменить параметры конфигурации после установки, вам надо
    будет повторить только три последних шага. Так же вам надо будет
    рестартовать Apache, чтобы новые модули подгрузились и начали работать.
    Перекомпиляция Apache для этого не требуется.
                
    Заметьте, что 'make install' установит так же PEAR,
    различные инструменты PHP - такие как phpize, версию PHP для командной
    строки (PHP CLI) и т.д.
    
13. Настройка вашего php.ini 
    
    cp php.ini-dist /usr/local/lib/php.ini
          
    Вероятно, вы захотите изменить некоторые настройки в php.ini.
    Если вы предпочитаете держать файл php.ini в другом месте, используйте
    параметр --with-config-file-path=/some/path в шаге 10. Если вы используете
    php.ini-recomended, прочитайте его, чтобы знать какие изменения в
    поведении PHP это повлечет.

14. Отредактируйте ваш httpd.conf, чтобы Apache подгружал модуль PHP. Путь в
    инструкции LoadModule должен указывать на модуль PHP. Команда make
    install может добавить эту иструкцию автоматически, но этого может и не
    произойти, поэтому проверьте, чтобы убедиться.

    Для PHP 4:
  
      LoadModule php4_module modules/libphp4.so
      
    Для PHP 5:
    
      LoadModule php5_module modules/libphp5.so
 
15. Теперь следует сконфигурировать Apache, чтобы он передавал файлы с
    некоторыми расширениями на обработку модулю PHP. В нашем примере сделаем
    это для файлов с расширениями .php и .phtml. Вы можете добавить так же
    другие расширения в конец строки, разделяя их символом пробела.
            
      AddType application/x-httpd-php .php .phtml
                  
    Сделаем то же самое для расширения .phps - модуль PHP покажет его как
    исходный код с подстветкой синтаксиса, вместо того, чтобы исполнять.
    
      AddType application/x-httpd-php-source .phps
 
16. Используйте стандартную процедуру запуска Apache, например:
   
      /usr/local/apache2/bin/apachectl start
   
]]>

      </screen>
     </example>
    <para>
     Следуя иструкциям выше вы запустите веб-сервер Apache 2.0 с поддержкой
     PHP, как модуля <literal>SAPI</literal>. Конечно, для PHP и Apache
     доступно гораздо больше параметров конфигурации. Используйте 
     <command>./configure --help</command> для получения полного списка
     параметров конфигурации. Если вы хотите собрать многопоточную версию Apache 2.0, 
     вам следует заменить стандартный модуль MPM <filename>prefork</filename>
     на <filename>worker</filename> или <filename>perchild</filename>.
     Чтобы сделать это, нужно добавить в строку configure на шаге 6, описанном
     выше один из двух параметров
     <option role="configure">--with-mpm=worker</option> или
     <option role="configure">--with-mpm=perchild</option>. 
     Вам следует знать как могут повлиять такие изменения. Для получения
     подробной информации прочитайте документацию Apache касательно 
     <link xlink:href="&url.apache2.mpm;">модулей MPM</link>.
    </para>
    <note>
     <para>
      Если вы хотите использовать зависимый контент (content negotiation),
      прочитайте  
      <link linkend="faq.installation.apache.multiviews">Apache MultiViews 
      FAQ</link>.
     </para>
    </note>
    <note>
     <para>
      Для построения многопоточной версии Apache, ваша система должна
      поддерживать потоки. Это так же подразумевает сборку PHP c
      поддержкой Zend Thread Safety (ZTS). И, как следствие, не все
      расширения PHP смогут работать. Рекомендуется установка Apache с
      модулем MPM <filename>prefork</filename>.
     </para>
    </note>
   </sect1>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
