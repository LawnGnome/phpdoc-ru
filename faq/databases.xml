<?xml version="1.0" encoding="windows-1251"?>
<!-- EN-Revision: 1.27 Maintainer: irinagoble Status: ready -->
<!-- $Revision: 1.1 $ -->
 <chapter id="faq.databases">
  <title>Вопросы по Базам Данных</title>
  <titleabbrev>Вопросы по Базам Данных</titleabbrev>

  <para>
   Этот раздел содержит общие вопросы о связи между PHP и базами данных.
   Да, сегодня практически любая база данных может быть доступна из PHP.
  </para>

  <qandaset>
   <qandaentry id="faq.databases.mssql">
    <question>
     <para>
      Я слышал, что можно получить доступ к Microsoft SQL серверу из PHP. Как?
     </para>
    </question>
    <answer>
     <para>
      На Windows машинах, вы просто используете поддержку ODBC и
      соответсвующий ODBC драйвер.
     </para>
     <para>
      На Unix машинах для доступа к Microsoft SQL серверам вы можете
      использовать Sybase-CT драйвер, так как они (по крайней мере в
      основном) совместимы по протоколу. У Sybase есть  
      <ulink url="&url.sybase.ctlib;">бесплатная версия необходимых библиотек
      для Linux</ulink>. Для других Unix систем вам необходимо обратиться 
      в Sybase за соответствующими библиотеками.
      Также смотрите ответ на следующий вопрос.
     </para>
    </answer>
   </qandaentry>

   <qandaentry id="faq.databases.access">
    <question>
     <para>Могу ли я получить доступ к базам данных Microsoft Access?</para>
    </question>
    <answer>
     <para>
      Да. Если всё полностью выполняется под Windows 9x/Me или NT/2000,
      то у вас уже есть все необходимые средства, так как для баз данных 
      Microsoft Access вы можете использовать ODBC и драйверы ODBC от Microsoft.
     </para>
     <para>
      Если вы хотите связать PHP, выполняющийся на Unix, и MS Access на
      Windows, то вам будут нужны драйверы ODBC для Unix.
      Такие ODBC драйверы для Unix есть у <ulink url="&url.openlink;">OpenLink
      Software</ulink>. По бесплатной пилотной программе вы можете скачать
      пробную копию без срока истечения, а цены на комерчески поддерживаемую 
      версию начинаются от 675$.
     </para>
     <para>
      Другая возможность - хранить данные на SQL сервере, который имеет 
      ODBC драйверы для Windows, и затем обращаться к этой базе данных из
      Microsoft Access (используя ODBC) и из PHP (используя встроенные драйверы)
      или использовать промежуточный формат понятный и для Access, и для PHP,
      как то последовательные файлы или базы данных dBase.
      По этому поводу Тим Хэйз (Tim Hayes) из OpenLink software пишет:
      <blockquote>
       <para>
        Использование промежуточной базы данных - не очень хорошая идея, когда
        есть возможность работать с базой данных на прямую из PHP через ODBC,
        например с драйверами от OpenLink. Если вам всё-таки надо использовать
        промежуточный формат, OpenLink выпустил Virtuoso (механизм виртуальной
        базы данных) для NT, Linux и других платформ Unix.
        Пожалуйста, посетите наш <ulink url="&url.openlink;">web сайт</ulink>
        для бесплатной загрузки.
       </para>
      </blockquote>
     </para>
     <para>
      Другой проверенный вариант - использовать MySQL с её MyODBC драйверами на
      Windows и делать синхронизацию баз данных. Стив Лоренс (Steve Lawrence)
      пишет:
     </para>
     <para>
      <itemizedlist>
       <listitem>
        <simpara>
         Установите MySQL согласно поставляемым с ней инструкциям.
         Последняя версия доступна с <ulink url="&url.mysql;">www.mysql.com</ulink>
         (получите её с ближайшего зеркала!). Особой конфигурации не требуется,
         за исключением того, что при настройке баз данных и создании пользователя, 
         в поле хоста вы должны поместить % или имя Windows машины, на которую
         вы хотите получить доступ из MySQL. Запишите имя вашего сервера,
         имя пользователя и пароль.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         Скачайте MyODBC драйвер для Windows с сайта MySQL. Последний релиз -
         myodbc-2_50_19-win95.zip (доступен также для NT и как исходный код).
         Установите его на вашей Windows машине. Вы можете проверить его 
         работоспособность с помощью поставляемых с ним утилит.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         Создайте пользователя или системный dsn в вашем администраторе ODBC,
         расположенном в контрольной панели. Создайте dsn имя, введите имя хоста,
         имя пользователя, пароль и т.д. для вашей базы данных MySQL,
         сконфигурированной на 1-ом шаге.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         Запустите полную инсталяцию Access, это даст вам уверенность, что вы 
         получите все нужные добавки (add-ins). По крайней мере вам будут 
         необходимы поддержка ODBC и администратор связанных таблиц.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         И теперь самое интересное! Создайте новую базу данных Access.
         В окне таблицы щёлкните правой кнопкой мышки и выберите Link Tables
         (Связать Таблицы), либо из файлового меню выберите Get External Data
         (Получить Внешние Данные) и затем Link Tables. В появившемся окне
         просмотра файлов выберите файлы типа ODBC.
         Выберите системный dsn и имя вашего dsn, созданного на 3-ем шаге.
         Выберите таблицу для связи, нажмите OK и вуаля! Теперь вы можете
         открыть таблицу и добавить/удалить/отредактировать данные на вашем
         MySQL сервере! Вы также можете строить запросы, импортировать/экспортировать
         таблицы в MySQL, создавать формы и отчёты, и т.д.
        </simpara>
       </listitem>
      </itemizedlist>
     </para>
     <para>
      Полезные Советы и Трюки:
      <itemizedlist>
       <listitem>
        <simpara>
         Вы можете построить ваши таблицы в Access, экспортировать их в MySQL
         и затем привязать их назад. Это убыстряет создание таблиц.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         При создании таблиц в Access, вы должны определить первичный ключ, 
         чтобы иметь доступ к таблице по записи. Убедитесь что вы создали
         первичный ключ в MySQL перед тем как привязать таблицу к Access.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         Если вы изменяете таблицу в MySQL, то вы должны связать её с Access
         по-новой. Идите в tools&gt;add-ins&gt;linked table manager,
         следуйте к вашему ODBC DSN, и выберите оттуда таблицу для пересвязки.
         Там же вы можете изменить источник вашего dsn, для этого, перед тем как
         нажать OK,  просто пометьте "always prompt for new location"
         (всегда запрашивать новое местонахождение).
        </simpara>
       </listitem>
      </itemizedlist>
     </para>
    </answer>
   </qandaentry>

   <qandaentry id="faq.databases.upgraded">
    <question>
     <para>
      Я обновился до PHP 4 и теперь mysql постоянно выдает
      "Warning: MySQL: Unable to save result set in ..."
      (Предупреждение: MySQL: Не могу сохранить результат в ...). Что это?
     </para>
    </question>
    <answer>
     <para>
      Вероятнее всего PHP 4 был скомпилирован с опцией <option
      role="configure">--with-mysql</option> без задания пути к MySQL.
      Это означает, что PHP использует его встроенную клиентскую библиотеку MySQL.
      Если на вашей системе выполняются приложения (такие как PHP 3, в виде 
      паралельного модуля Apache, или auth-mysql), которые используют другие
      версии MySQL клиентов, то возникает конфликт между двумя разными 
      версиями этих клиентов.
     </para>
     <para>
      Обычно, перекомпиляция PHP 4 с указанием пути к MySQL в опции
      '<link linkend="mysql.configure">--with-mysql=/your/path/to/mysql</link>' 
      решает эту проблему.
     </para>
    </answer>
   </qandaentry>
   
   <qandaentry id="faq.databases.mysql.php5">
    <question>
     <para>
      Клиентские библиотеки MySQL больше не включены в PHP 5,
      как это отразится на мне? Могу ли я всё так же использовать MySQL c PHP?
      Я пытаюсь работать с MySQL и получаю ошибки "function undefined" (функция
      неопределена), что выдаёт их? 
     </para>
    </question>
    <answer>
     <para>
      Да. PHP всегда будет поддерживать MySQL в том или ином виде.
      Единственное что изменилось в PHP 5 - это то, что мы больше
      не поставляем саму клиентскую библиотеку. Вот некоторые причины для этого:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Сегодня клиентские библиотеки уже установлены на большинстве систем.
       </para>
      </listitem>
      <listitem>
       <para>
        Учитывая предыдущий пункт, имея несколько версий, проще запутаться.
        Например, если вы компонуете mod_auth_mysql с одной версией,
        а PHP с другой, и затем разрешаете оба в Apache, то вы получите хороший
        жирный крах. Также, поставляемые библиотеки не всегда дружат с 
        установленной серверной версией. Наиболее очевидный симптом этого -
        разногласие по тому где искать файл mysql.socket (файл Unix сокета).
       </para>
      </listitem>
      <listitem>
       <para>
        Также поддержка была вялой и отставала от релизов всё больше и больше.
       </para>
      </listitem>
      <listitem>
       <para>
        Последующие версии библиотеки будут под GPL и мы не можем поставлять
        библиотеку под GPL с проектом лицензируемым по типу BSD/Apache.
        Поэтому полный разрыв в PHP 5 видится как самый лучший вариант.
       </para>
      </listitem>
     </itemizedlist>
     <para>
      На самом деле это заденет не так уж много людей. Пользователи Unix, 
      по крайней мере те, кто знает что они делают, всегда были склонны
      собирать PHP с уже установленной на их системе библиотекой libmesqlclient,
      просто задав опцию <option role="configure">--with-mysql=/usr</option>
      при сборке. Пользователи Windows могут включить расширение 
      <filename>php_mysql.dll</filename> внутри &php.ini;. Также убедитесь,
      что <filename>libmysql.dll</filename> доступен в системном PATH.
      О том как - читайте FAQ: <link linkend="faq.installation.addtopath">
      установка системного PATH в Windows</link>. Так как 
      <filename>libmysql.dll</filename> (и многие другие PHP файлы) находится
      в папке PHP, вам лучше добавить PHP папку в ваш системный PATH.
     </para>
    </answer>
   </qandaentry>

   <qandaentry id="faq.databases.shared-mysql">
    <question>
     <para>
      После установки поддержки разделения в MySQL, Apache выдаёт дампы сразу
      после загрузки libphp4.so. Можно ли это исправить?
     </para>
    </question>
    <answer>
     <para>
      Это происходит если вы скомпоновали ваши библиотеки MySQL с pthreads.
      Проверьте используя ldd. Если это так, скомпилируйте MySQL из исходников
      или перекомпилируйте исходный rpm, отключив поточный код клиента в 
      файле спецификации. Любой из этих вариантов исправит проблему. 
      Затем перекомпилируйте PHP с новыми библиотеками MySQL.
     </para>
    </answer>
   </qandaentry>

   <qandaentry id="faq.databases.mysqlresource">
    <question>
     <para>
      Почему я получаю ошибки типа 
      "Warning: 0 is not a MySQL result index in &lt;file&gt; 
      on line &lt;x&gt;" или "Warning: Supplied argument is not 
      a valid MySQL result resource in &lt;file&gt; on line &lt;x&gt;?
     </para>
    </question>
    <answer>
     <para>
      Вы пытаетесь использовать идентификатор результата, который равен 0.
      0 означает что ваш запрос неудался по какой-либо причине. Вам необходимо
      сделать проверку на ошибки после того как вы послали ваш запрос и перед
      тем как вы пытаетесь использовать возвращённый идентификатор результата.
      Правильный способ для этого выглядит примерно как следующий код:
      <programlisting role="php">
<![CDATA[
<?php

$result = mysql_query("SELECT * FROM tables_priv");
if (!$result) {
    echo mysql_error();
    exit;
}
?>
]]>
      </programlisting>
      или
      <programlisting role="php">
<![CDATA[
<?php

$result = mysql_query("SELECT * FROM tables_priv")
    or die("Bad query: " . mysql_error());
?>
]]>
      </programlisting>
     </para>
    </answer>
   </qandaentry>
  </qandaset>
 </chapter>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->

