<?xml version="1.0" encoding="utf-8"?>
<!-- EN-Revision: 306787 Maintainer: shein Status: ready -->
<!-- Reviewed: no -->
<!-- $Id -->
 <chapter xml:id="faq.installation" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
  <title>Установка</title>
  <titleabbrev>Установка</titleabbrev>

  <para>
   Этот раздел содержит общие вопросы по установке PHP.
   PHP доступен практически для любой ОС (за исключением, может быть,
   MacOS предшествующей OSX) и любого web сервера.
  </para>
  <para>
   Для установки PHP следуйте инструкциям в <xref linkend="install"/>.
  </para>

  <qandaset>
   <qandaentry xml:id="faq.installation.apache2">
    <question>
     <para>
      Почему я не должен использовать Apache2 с потоковым MPM в промышленном окружении?
     </para>
    </question>
    <answer>
     <para>
      PHP - это клей. Клей, используемый для построения классных веб-приложений,
      склеивая дюжины сторонних библиотек и создавая впечатление одного согласованного
      целого, с помощью интуитивного и легко изучаемого языка.
      Гибкость и мощь PHP полагается на стабильность и устойчивость используемой
      платформы. Для склейки вместе ему необходимы работающая ОС, работающий
      веб-сервер и работающие сторонние библиотеки. Когда что-либо из этого перестаёт
      работать, PHP нужны способы определения проблем и их быстрого исправления.
      Если вы усложняете низлежащую систему, не разделяя полностью потоки выполнения,
      не выделяя раздельные сегменты памяти и не предоставляя "песочницу" для
      игры для каждого запроса, то в вашей PHP системе появятся слабые места.
     </para>
     <para>
      Если вы всё-таки чувствуете, что должны использовать потоковый MPM,
      взгляните на конфигурацию с FastCGI, где вы можете запускать PHP
      в своём собственном пространстве памяти.
     </para>
     <para>
      И наконец, это предупреждение против потокового MPM не настолько остро для
      пользователей Windows, так как большинство библиотек на этой платформе
      потокобезопасны.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.phpini">
    <question>
     <para>
      Unix/Windows: Где должен находиться файл &php.ini;?
     </para>
    </question>
    <answer>
     <para>
      На Unix по умолчанию он должен находиться в директории 
      <filename>/usr/local/lib</filename>, определяемой как
      <filename>&lt;install-path&gt;/lib</filename>.
      Большинство людей изменяют его во время компиляции с помощью опции
      <link linkend="configure.with-config-file-path">--with-config-file-path</link>
      Для примера, вы можете задать что-то типа:
      <programlisting role="shell">
--with-config-file-path=/etc
      </programlisting>
      Затем скопировать файл <filename>php.ini-development</filename> из
      дистрибутива в <filename>/etc/php.ini</filename> и отредактировать
      его для ваших локальных нужд.
     </para>
      <programlisting role="shell">
--with-config-file-scan-dir=PATH 
      </programlisting>
     <para>
      На Windows по умолчанию &php.ini; находится в Windows директории.
      Если вы используете веб-сервер Apache, &php.ini; сначала ищется в
      директории, где был установлен Apache, например, <filename>c:\program
      files\apache group\apache</filename>. В этом случае на одной машине
      у вас могут быть разные файлы &php.ini; для разных версий Apache.
     </para>
     <para>
     Смотрите также главу о <link
     linkend="configuration.file">конфигурационном файле</link>.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.nodata">
    <question>
     <para>
      Unix: Я установил PHP, но каждый раз при загрузке документа я получаю 
      сообщение 'Document Contains No Data' (Документ Не Содержит Данных)!
      Что происходит?
     </para>
    </question>
    <answer>
     <para>
      Вероятно, PHP падает по какой-то причине. Для того, чтобы убедиться в этом,
      просмотрите лог ошибок вашего сервера и затем попытайтесь воспроизвести
      проблему с помощью небольшого тестового примера. Если вы умеете пользоваться
      'gdb', то добавьте трассировку к вашему сообщению об ошибке, это поможет
      разработчикам точно определить проблему. 
      Если вы используете PHP как модуль Apache, попробуйте что-то типа:
      <itemizedlist>
       <listitem>
        <para>
         Остановите ваши httpd процессы
        </para>
       </listitem>
       <listitem>
        <para>
         gdb httpd
        </para>
       </listitem>
       <listitem>
        <para>
         Остановите ваши httpd процессы
        </para>
       </listitem>
       <listitem>
        <para>
         &gt; run -X -f /path/to/httpd.conf
        </para>
       </listitem>
       <listitem>
        <para>
         Затем вызовите URL, на котором возникает проблема, из вашего браузера
        </para>
       </listitem>      
       <listitem>
        <para>
         &gt; run -X -f /path/to/httpd.conf
        </para>
       </listitem>      
       <listitem>
        <para>
         Если вы получаете дамп, gdb должен сейчас же сообщить вам об этом
        </para>
       </listitem>      
       <listitem>
        <para>
         введите: bt
        </para>
       </listitem>
       <listitem>
        <para>
         Вам необходимо включить трассировку в ваше сообщение об ошибке, которое 
         должно быть отправлено с 
         <link xlink:href="&url.php.bugs;">&url.php.bugs;</link> 
        </para>
       </listitem>
      </itemizedlist>
     </para>
     <para>
      Если ваш скрипт использует функции регулярных выражений
      (<function>preg_match</function> и компания), то вам необходимо убедиться,
      что вы скомпилировали PHP и Apache с одним и тем же пакетом регулярных
      выражений. Это должно происходить автоматически для PHP и Apache 1.3.x
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.processing">
    <question>
     <para>
      Unix: Я установил PHP с помощью RPMS, но Apache не обрабатывает PHP страницы!
      Что происходит?
     </para>
    </question>
    <answer>
     <para>
      Полагая, что Apache и PHP оба были установлены из пакетов RPM,
      вам требуется в вашем файле &httpd.conf; раскомментировать или добавить
      все или некоторые из следующих строк:
      <programlisting role="apache-conf">
<![CDATA[
# Extra Modules
AddModule mod_php.c
AddModule mod_perl.c

# Extra Modules
LoadModule php_module         modules/mod_php.so
LoadModule php5_module        modules/libphp5.so
LoadModule perl_module        modules/libperl.so
]]>
      </programlisting>
      И добавить:
      <programlisting role="apache-conf">
<![CDATA[
AddType application/x-httpd-php .php
]]>
      </programlisting>
      ... в глобальные свойства или в свойства VirtualDomain, для которого
      вы хотите иметь поддержку PHP.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.frontpage">
    <question>
     <para>
      Unix: Я установил заплатку в Apache для расширений FrontPage и
      неожиданно PHP перестал работать.
      Неужели PHP не совместим с FrontPage расширениями для Apache?
     </para>
    </question>
    <answer>
     <para>
      Нет, PHP прекрасно работает с FrontPage расширениями.
      Проблема в том, что FrontPage заплатка изменяет некоторые важные для
      PHP структуры. Перекомпиляция PHP (с помощью 'make clean ; make')
      после установки FP заплатки должна решить эту проблему.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.blankscreen">
    <question>
     <para>
      Unix/Windows: Я установил PHP, но когда я пытаюсь вызвать PHP скрипт из моего
      браузера, я получаю пустой экран.
     </para>
    </question>
    <answer>
     <para>
      Сделайте просмотр исходника ('view source') в web браузере
      и, вероятно, вы увидите исходный код вашего PHP скрипта.
      Это означает, что web сервер не послал скрипт PHP для интерпретации.
      Что-то не так с конфигурацией сервера, проверьте конфигурацию сервера 
      согласно установочным инструкциям PHP.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.500error">
    <question>
     <para>
      Unix/Windows: Я установил PHP, но когда я пытаюсь вызвать PHP скрипт из моего
      браузера, я получаю ошибку сервера 500.
     </para>
    </question>
    <answer>
     <para>
      Что-то произошло когда сервер пытался выполнить PHP. 
      Чтобы увидеть более вразумительное сообщение об ошибке,
      используя командную строку, перейдите в директорию где находится
      исполняемый файл PHP (<filename>php.exe</filename> на Windows)
      и запустите <command>php -i</command>. Если при запуске PHP
      возникли какие-либо проблемы, то появится соответствующее сообщение
      об ошибке, которое может дать вам понять что делать дальше.
      Если вы получаете экран, заполненый HTML кодом (вывод функции
      <function>phpinfo</function>), то PHP работает и ваша
      проблема возможно связана с конфигурацией вашего сервера, которую
      вам необходимо проверить.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.undefinedsyms">
    <question>
     <para> 
      Некоторые операционные системы: Я установил PHP без ошибок,
      но когда я пытаюсь запустить Apache, я получаю ошибки "undefined symbol"
      (неопределённый символ):
      <programlisting role="shell">
[mybox:user /src/php5] root# apachectl configtest
 apachectl: /usr/local/apache/bin/httpd Undefined symbols:
  _compress
  _uncompress
      </programlisting>
     </para>
    </question>
    <answer>
     <para>
      На самом деле это связано с клиентскими библиотеками MySQL и не имеет
      никакого отношения к PHP. Одним нужна опция <option
      role="configure">--with-zlib</option>, другим - нет. Это также 
      описано в MySQL FAQ.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.cgierror">
    <question>
     <para>
      Windows: Я установил PHP, но когда я пытаюсь вызвать PHP скрипт из моего
      браузера, я получаю ошибку:
      <screen>
<![CDATA[
cgi error:
 The specified CGI application misbehaved by not
 returning a complete set of HTTP headers.
 The headers it did return are:
]]>
      </screen>
     </para>
    </question>
    <answer>
     <para>
      Это сообщение об ошибке означает, что PHP не смог вывести 
      абсолютно ничего. Чтобы увидеть более вразумительное сообщение об ошибке,
      используя командную строку, перейдите в директорию, где находится
      исполняемый файл PHP (<filename>php.exe</filename> на Windows) и
      запустите <command>php -i</command>. Если при запуске PHP 
      возникли какие-либо проблемы, то появится соответствующее сообщение
      об ошибке, которое может дать вам понять, что делать дальше.
      Если вы получаете экран, заполненый HTML кодом (вывод функции
      <function>phpinfo</function> функции), то PHP работает.
     </para>
     <para>
      Как только PHP заработает из командной строки, попытайтесь опять вызвать
      скрипт из браузера. Если он все также не работает, то причина может быть 
      одной из следующих:
     </para>
     <itemizedlist>
      <listitem>
       <simpara>
        Анонимный пользователь Internet <literal>ISUR_&lt;machinename&gt;</literal>
        не имеет доступ к вашему PHP скрипту,
        <filename>php.exe</filename>, <filename>php4ts.dll</filename>,
        &php.ini; или любому загружаемому PHP расширению из за прав доступа,
        установленных на эти файлы.
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        Файл скрипта не существует (или, вероятно, не там где вы думаете он
        должен быть, относительно вашей корневой web директории).
        Заметьте, что для IIS вы можете поймать эту ошибку пометив 'check file
        exists' при настройке ассоциирования скриптов (script mappings) в
        Администраторе Internet Сервисов (Internet Services Manager).
        Если файл скрипта не существует, то сервер выдаст ошибку 404.
        Также есть дополнительное преимущество, заключащееся в том, что IIS будет выполнять
        необходимую вам аутентификацию, основываясь на NTLanMan правах
        доступа на ваш скрипт.
       </simpara>
      </listitem>
     </itemizedlist>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.phpandiis">
    <question>
     <para>
      Windows: Я следовал всем инструкциям, но так и не смог заставить PHP и IIS
      работать вместе!
     </para>
    </question>
    <answer>
     <para>
      Убедитесь что все пользователи, кому необходимо запускать PHP скрипты,
      имеют право выполнять <filename>php.exe</filename>! 
      IIS использует анонимного пользователя, который добавлен во время 
      установки IIS. Этот пользователь должен иметь права на 
      <filename>php.exe</filename>. Также любому аутентифицированному пользователю
      будут нужны права на выполнение <filename>php.exe</filename>.
      И для IIS4 вам необходимо сказать ему, что PHP является скриптовой системой.
      Также вам захочется прочитать 
      <link linkend="faq.installation.forceredirect">это</link>.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.forceredirect">
    <question>
     <para>
       Когда PHP запускается как CGI в IIS, PWS, OmniHTTPD или Xitami,
       я получаю следующую ошибку: <literal>Security Alert! PHP CGI 
       cannot be accessed directly.</literal>.
     </para>
    </question>
    <answer>
     <para>
      Вы должны установить директиву <link linkend="ini.cgi.force-redirect">
      cgi.force_redirect</link> в <literal>0</literal>.
      По умолчанию она установлена в <literal>1</literal>, поэтому убедитесь, что
      директива не закоментирована (с <literal>;</literal>). Как все директивы,
      она задается в &php.ini;
     </para>
     <para>
      Так как значение по умолчанию <literal>1</literal>, то очень важно
      быть уверенным на 100%, что был прочитан верный &php.ini; файл.
      Для подробностей читайте <link linkend="faq.installation.findphpini">
      здесь</link>.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.findphpini">
    <question>
     <para>
      Как узнать, что мой &php.ini; был найден и прочтён?
      Похоже, что мои изменения не были восприняты?
     </para>
    </question>
    <answer>
     <para>
      Чтобы убедиться, что PHP прочитал ваш &php.ini;, вызовите
      <function>phpinfo</function> и недалеко от начала будет находиться
      строка, озаглавленная <literal>Configuration File (php.ini)</literal>.
      Она скажет вам, где PHP ищет &php.ini; и был ли файл прочитан.
      Если указана только директория, то файл не был прочитан и вы должны поместить
      ваш &php.ini; в эту директорию. Если &php.ini; включён в PATH, то он
      был прочитан.
     </para>
     <para>
      Если &php.ini; был прочитан и вы запускаете PHP как модуль, то 
      не забудьте перезапустить ваш web сервер после внесения изменений в
      &php.ini;. 
     </para>
     <para>
      Смотрите также <function>php_ini_loaded_file</function>.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.addtopath">
    <question>
     <para>
      Как на Windows добавить мою PHP директорию в <varname>PATH</varname>?
     </para>
    </question>
    <answer>
     <para>
      На Windows NT+ и Windows Server 2000+:
      <itemizedlist>
       <listitem><para>
        Зайдите в Control Panel и откройте системную иконку (Start -&gt; Settings
        -&gt; Control Panel -&gt; System, или просто Start -&gt; Control Panel
        -&gt; System for Windows XP/2003)
       </para></listitem>
       <listitem><para>
        Перейдите в закладку Advanced
       </para></listitem>
       <listitem><para>
        Нажмите кнопку 'Environment Variables'
       </para></listitem>
       <listitem><para>
        Смотрите в окошко 'System Variables'
       </para></listitem>
       <listitem><para>
        Найдите Path (возможно, вам придется сделать прокрутку, чтобы найти его)
       </para></listitem>
       <listitem><para>
        Двойной щелчок на Path
       </para></listitem>
       <listitem><para>
        Добавьте в конец вашу PHP директорию, поставив спереди ';' (например
        <literal>;C:\php</literal>)
       </para></listitem>
       <listitem><para>
        Нажмите OK
       </para></listitem>
      </itemizedlist>
     </para>
     <para>
      На Windows 98/Me вам необходимо отредактировать файл
      <filename>autoexec.bat</filename>:
      <itemizedlist>
       <listitem><para>
        Откройте Notepad (Start -&gt; Run и введите notepad)
       </para></listitem>
       <listitem><para>
        Откройте файл <filename>C:\autoexec.bat</filename>
       </para></listitem>
       <listitem><para>
        Найдите строку с PATH=C:\WINDOWS;C:\WINDOWS\COMMAND;..... и добавьте
        в конец строки:
        <literal>;C:\php</literal>
       </para></listitem>
       <listitem><para>
        Сохраните файл и перезапустите ваш компьютер
       </para></listitem>
      </itemizedlist>
     </para>
     <note>
      <simpara>
       Обязательно перезагрузитесь после указанных шагов для
       уверенности, что внесенные вами изменения были применены к
       <varname>PATH</varname>.
      </simpara>
     </note>
     <para>
      Прежде в руководстве по PHP рекомендовалось копировать файлы в системную
      директорию Windows, так как эта директория  
      (<filename>C:\Windows</filename>, <filename>C:\WINNT</filename>, и т.п.)
      входит в системный PATH по умолчанию. Копирование файлов в системную директорию
      Windows давно уже противопоказано и может вызвать проблемы.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.phprc">
    <question>
     <para>
      Как в Windows сделать файл &php.ini; доступным для PHP?
     </para>
    </question>
    <answer>
     <para>
      Для этого есть несколько путей. Если вы используете Apache, то читайте
      инструкции по его установке (<link
       linkend="install.windows.apache1">Apache 1</link>, <link
       linkend="install.windows.apache2">Apache 2</link>), 
      в ином случае, вы должны установить переменную окружения
      <varname>PHPRC</varname>:
     </para>
     <para>
      На Windows NT, 2000, XP и 2003:
      <itemizedlist>
       <listitem><para>
        Зайдите в Control Panel и откройте системную иконку (Start -&gt; Settings
        -&gt; Control Panel -&gt; System, или просто Start -&gt; Control Panel
        -&gt; System for Windows XP/2003)
       </para></listitem>
       <listitem><para>
        Перейдите в закладку Advanced
       </para></listitem>
       <listitem><para>
        Нажмите кнопку 'Environment Variables'
       </para></listitem>
       <listitem><para>
        Посмотрите в окошко 'System variables'
       </para></listitem>
       <listitem><para>
         Щёлкните на 'New' и введите 'PHPRC' как имя переменной и директорию, 
         где находится &php.ini;, как значение переменной (например,
         <literal>C:\php</literal>)
       </para></listitem>
       <listitem><para>
        Нажмите OK и перезапустите ваш компьютер
       </para></listitem>
      </itemizedlist>
     </para>
     <para>
      На Windows 98/Me вам необходимо отредактировать файл
      <filename>autoexec.bat</filename>:
      <itemizedlist>
       <listitem><para>
        Откройте Notepad (Start -&gt; Run и введите notepad)
       </para></listitem>
       <listitem><para>
        Откройте файл <filename>C:\autoexec.bat</filename>
       </para></listitem>
       <listitem><para>
        Добавьте новую строку в конец файла: <literal>set
         PHPRC=C:\php</literal> (замените <literal>C:\php</literal> на директорию,
        где находится &php.ini;). Учтите, что путь не должен содержать
        пробелы. Например, если вы установили PHP в
        <filename>C:\Program Files\PHP</filename>, вы можете
        вместо этого ввести <filename>C:\PROGRA~1\PHP</filename>.
       </para></listitem>
       <listitem><para>
        Сохраните файл и перезапустите ваш компьютер
       </para></listitem>
      </itemizedlist>
     </para>      
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.apache.multiviews">
    <question>
     <para>
      Возможно ли использовать согласование содержания в Apache
      (опция MultiViews) c PHP?
     </para>
    </question>
    <answer>
     <para>
      Всё работает замечательно, если ссылки на PHP файлы имеют расширение.
      Этот FAQ рассматривает только случай, когда ссылки на PHP файлы не имеют расширения
      и вы хотите использовать согласование содержания для отбора PHP файлов из
      URL без расширений.
      В этом случае, замените строку <literal>AddType application/x-httpd-php
      .php</literal> на:
      <programlisting role="apache-conf">
<![CDATA[
AddHandler php5-script php
AddType text/html php
]]>
     </programlisting>
     Это решение не работает в Apache 1, так как в нём PHP модуль не ловит
     <literal>php-script</literal>.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.requestmethods">
    <question>
     <para>
      PHP может обрабатывать только GET и POST запросы?
     </para>
    </question>
    <answer>
     <para>
      Нет, можно обрабатывать любые запросы, например, CONNECT.
      Необходимый статус ответа можно послать с помощью функции
      <function>header</function>.
      Если нужно обрабатывать только GET и POST запросы, то этого
      можно достигнуть с помощью такой конфигурации Apache:
      <programlisting role="apache-conf">
<![CDATA[
<LimitExcept GET POST>
Deny from all
</LimitExcept>
]]>
     </programlisting>
     </para>
    </answer>
   </qandaentry>

  </qandaset>
 </chapter>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
