<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision: 1.4 $ -->
 <reference id="ref.oci8">
  <title>Функции для работы с Oracle</title>
  <titleabbrev>OCI8</titleabbrev>

  <partintro>
   <section id="oci8.intro">
    &reftitle.intro;
    <para>
     Эти функции позволяют вам работать с Oracle версий 10/9/8/7.
     Для этого используется библиотека Oracle Call Interface (OCI).
    </para>
    <para>
     Данный модуль много гибче <link linkend="ref.oracle">прежнего</link>. 
     Он содержит функции привязки переменных PHP к соответствующим
     меткам Oracle, расширенную поддержка LOB, FILE и ROWID.
     Использование этого модуля рекомендуется вместо 
     <link linkend="ref.oracle">старого модуля</link>.
    </para>
   </section>

   <section id="oci8.requirements">
    &reftitle.required;
    <para>
     Вам понадобятся клиентские библиотеки Oracle для того, чтобы использовать
     этот модуль. Пользователям Windows будут необходимы библиотеки минимум
     версии 10 для того, чтобы использовать <filename>php_oci8.dll</filename>.
    </para>
    <para>
     Мы рекомендуем вам использовать Oracle Instant Client, доступный по
     адресу <ulink url="&url.oracle.instant.client;">&url.oracle.instant.client;</ulink>.
     Для использования модуля OCI8 достаточно установить "basic" версию пакета 
     Oracle Instant Client. Instant Client не требует установки переменных 
     ORACLE_SID или ORACLE_HOME. Однако, вам возможно понадобится установить 
     переменные окружения LD_LIBRARY_PATH и NLS_LANG.
    </para>
    <para>
     Перед использованием этого модуля, проверьте, что вы установили все
     необходимые переменные окружения. Эти переменные, перечисленные ниже,
     должны быть доступны пользователю Oracle и пользователю, с правами
     которого работает веб-сервер. Переменные окружения, необходимые для
     корректной работы с Oracle:
     <itemizedlist>
      <listitem>
       <simpara>
        ORACLE_HOME
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        ORACLE_SID
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        LD_PRELOAD
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        LD_LIBRARY_PATH
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        NLS_LANG
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        ORA_NLS33
       </simpara>
      </listitem>
     </itemizedlist>
    </para>
    <para>
     После установки среды окружения для веб-сервера, добавьте
     пользователя, с правами которого работает веб-сервер, в группу oracle.
    </para>
    <note>
     <title>Если ваш веб-сервер не стартует или возвращает ошибку при старте</title>
     <para>
      Проверьте, что Apache был слинкован с библиотекой
      <literal>pthread</literal>: 
     </para>
     <para>
     <informalexample>
      <screen>
<![CDATA[
# ldd /www/apache/bin/httpd 
    libpthread.so.0 => /lib/libpthread.so.0 (0x4001c000)
    libm.so.6 => /lib/libm.so.6 (0x4002f000)
    libcrypt.so.1 => /lib/libcrypt.so.1 (0x4004c000)
    libdl.so.2 => /lib/libdl.so.2 (0x4007a000)
    libc.so.6 => /lib/libc.so.6 (0x4007e000)
    /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x40000000)
]]>
      </screen>
     </informalexample>
    </para>
    <para>
     Если libpthread не присутствует в списке, то вам придется переустановить Apache:
    </para>
    <para>
     <informalexample>
      <screen>
<![CDATA[
# cd /usr/src/apache_1.3.xx
# make clean
# LIBS=-lpthread ./config.status
# make
# make install
]]>
      </screen>
     </informalexample>
    </para>
    <para>
     Обратите внимание на то, что на некоторых системах, например, UnixWare,
     вместо <literal>libthread</literal> присутствует
     <literal>libpthread</literal>. PHP и Apache также должны быть собраны с 
      EXTRA_LIBS=-lthread.
    </para>
   </note>
   </section>

   &reference.oci8.configure;

   <section id="oci8.configuration">
    &reftitle.runtime;
    &no.config;
   </section>

   <section id="oci8.resources">
    &reftitle.resources;
    <para>
    </para>
   </section>

   &reference.oci8.constants;

   <section id="oci8.examples">
   &reftitle.examples;
    <para>
    <example>
     <title>Примеры использования</title>
      <programlisting role="php">
<![CDATA[
<?php
// by sergo at bacup dot ru

// Use option: OCI_DEFAULT for execute command to delay execution
OCIExecute($stmt, OCI_DEFAULT);

// for retrieve data use (after fetch):

$result = OCIResult($stmt, $n);
if (is_object($result)) $result = $result->load();

// For INSERT or UPDATE statement use:

$sql = "insert into table (field1, field2) values (field1 = 'value',
 field2 = empty_clob()) returning field2 into :field2";
OCIParse($conn, $sql);
$clob = OCINewDescriptor($conn, OCI_D_LOB);
OCIBindByName($stmt, ":field2", &$clob, -1, OCI_B_CLOB);
OCIExecute($stmt, OCI_DEFAULT);
$clob->save("some text");
OCICommit($conn);

?>
]]>
     </programlisting>
    </example>
    </para>
    <para>
     Вы можете использовать хранимые процедуры так же, как это делается из
     командной строки.
    <example>
     <title>Использование хранимых процедур</title>
      <programlisting role="php">
<![CDATA[
<?php
// by webmaster at remoterealty dot com
$sth = OCIParse($dbh, "begin sp_newaddress( :address_id, '$firstname',
 '$lastname', '$company', '$address1', '$address2', '$city', '$state',
 '$postalcode', '$country', :error_code );end;");

// This calls stored procedure sp_newaddress, with :address_id being an
// in/out variable and :error_code being an out variable. 
// Then you do the binding:

   OCIBindByName($sth, ":address_id", $addr_id, 10);
   OCIBindByName($sth, ":error_code", $errorcode, 10);
   OCIExecute($sth);

?>
]]>
      </programlisting>
    </example>
    </para>
   </section>

  </partintro>

&reference.oci8.functions;

 </reference>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->

